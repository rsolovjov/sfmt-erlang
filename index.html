<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>sfmt-erlang by jj1bdx</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>sfmt-erlang</h1>
        <p>sfmt-erlang: SIMD-oriented Fast Mersenne Twister (SFMT) for Erlang</p>

        <p class="view"><a href="https://github.com/jj1bdx/sfmt-erlang">View the Project on GitHub <small>jj1bdx/sfmt-erlang</small></a></p>


        <ul>
          <li><a href="https://github.com/jj1bdx/sfmt-erlang/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/jj1bdx/sfmt-erlang/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/jj1bdx/sfmt-erlang">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="sfmt-erlang-simd-oriented-fast-mersenne-twister-sfmt-for-erlang" class="anchor" href="#sfmt-erlang-simd-oriented-fast-mersenne-twister-sfmt-for-erlang"><span class="octicon octicon-link"></span></a>sfmt-erlang: SIMD-oriented Fast Mersenne Twister (SFMT) for Erlang</h1>

<ul>
<li>Version 0.8.2_RELEASE 28-MAY-2012 (README last modified 22-FEB-2014)</li>
<li>Edited and written by Kenji Rikitake (Kyoto University)</li>
<li>Email contact: <a href="mailto:kenji.rikitake@acm.org">kenji.rikitake@acm.org</a>
</li>
</ul><p>Copyright (c) 2010-2014 Kenji Rikitake and Kyoto University. All rights
reserved.</p>

<p>Copyright (c) 2006,2007 Mutsuo Saito, Makoto Matsumoto and Hiroshima
University. All rights reserved.</p>

<p>See the file <code>LICENSE</code> for the license (new/simplified BSD license). (Note:
license of rebar is Apache 2.0 License.)</p>

<p>This software is based on SFMT ver. 1.3.3 (SIMD oriented Fast Mersenne
Twister(SFMT)) by Mutsuo Saito (Hiroshima University) and Makoto
Matsumoto (Hiroshima University)</p>

<h2>
<a name="details-of-sfmt-algorithm" class="anchor" href="#details-of-sfmt-algorithm"><span class="octicon octicon-link"></span></a>Details of SFMT algorithm</h2>

<p>See <a href="http://www.math.sci.hiroshima-u.ac.jp/%7Em-mat/MT/SFMT/index.html">http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/SFMT/index.html</a></p>

<ul>
<li>new module sfmt607 and sfmt216091 added (from 0.5.1_RELEASE)</li>
<li>new module sfmt4253 added (from 0.5.3_RELEASE)</li>
<li>new module sfmt86243 added (from 0.6.1_BETA)</li>
<li>Pure SFMT module now added as working code by request (from 0.8.0_RELEASE)</li>
</ul><h2>
<a name="seeding-algorithm-changed-for-seedinteger-functions" class="anchor" href="#seeding-algorithm-changed-for-seedinteger-functions"><span class="octicon octicon-link"></span></a>Seeding algorithm changed for <code>seed(integer())</code> functions</h2>

<ul>
<li>The old <code>seed/1</code> function called <code>init_gen_rand/1</code> (up to 0.8.0_RELEASE)</li>
<li>The internal state generated by <code>init_gen_rand/1</code> is predictable,
especially when the value of the 1st element of the state list is
very close to the given seed value. 
(Michael Gebetsroither discovered this behavior)</li>
<li>The new <code>seed/1</code> function calls <code>init_by_list32/1</code> (from 0.8.1_RELEASE)
and the seed is given as <code>[integer()]</code>,
to reduce predictability of the 1st element of the state list.</li>
</ul><h2>
<a name="supported-sfmt-prng-periods" class="anchor" href="#supported-sfmt-prng-periods"><span class="octicon octicon-link"></span></a>Supported SFMT PRNG periods</h2>

<ul>
<li>sfmt607: (2^607 - 1)</li>
<li>sfmt4253: (2^4253 - 1)</li>
<li>sfmt: (2^19937 - 1) (also on sfmt_pure)</li>
<li>sfmt86243: (2^86243 - 1)</li>
<li>sfmt216091: (2^216091 - 1)</li>
</ul><h2>
<a name="c-nifs-based-on-sfmt-133-added-from-030_release" class="anchor" href="#c-nifs-based-on-sfmt-133-added-from-030_release"><span class="octicon octicon-link"></span></a>C NIFs based on SFMT 1.3.3 added (from 0.3.0_RELEASE)</h2>

<ul>
<li>See <code>c_src/sfmt_nif.c</code> for the details</li>
<li>Also refer to sfmt-extstate at <a href="http://github.com/jj1bdx/sfmt-extstate">http://github.com/jj1bdx/sfmt-extstate</a>
</li>
<li>The version number of this NIF is 101 (see <code>NIF_LOAD_INFO</code> macro value)</li>
</ul><h2>
<a name="wichmann-hill-2006-algorithm-code-also-included-from-060_release" class="anchor" href="#wichmann-hill-2006-algorithm-code-also-included-from-060_release"><span class="octicon octicon-link"></span></a>Wichmann-Hill 2006 algorithm code also included (from 0.6.0_RELEASE)</h2>

<ul>
<li>See <code>src/random_wh06.erl</code> for the details</li>
<li>
<p>Reference for the algorithm:</p>

<p>B. A. Wichmann and I. D. Hill,
"Generating good pseudo-random numbers",
Computational Statistics &amp; Data Analysis 51 (2006) 1614-1622.    </p>
</li>
<li>
<p>See <code>src/random_wh06_int.erl</code> for a bigint version (by Michael Truog)</p>

<p>Note: this bigint version is not tested yet (no eunit test case)</p>
</li>
</ul><h2>
<a name="simple-test-of-512x512-pixmap-included-from-062_release" class="anchor" href="#simple-test-of-512x512-pixmap-included-from-062_release"><span class="octicon octicon-link"></span></a>Simple test of 512x512 pixmap included (from 0.6.2_RELEASE)</h2>

<ul>
<li>see the files under <code>reference_texts/pbm_512_512/</code> for the details</li>
</ul><h2>
<a name="notable-bugfixes" class="anchor" href="#notable-bugfixes"><span class="octicon octicon-link"></span></a>Notable bugfixes</h2>

<ul>
<li>
<code>gen_rand_all/1</code> is now properly applied in <code>sfmt_pure</code> module when <code>gen_rand32/1</code> was first invoked (from 0.8.2_RELEASE)</li>
<li>Catched up with the latest rebar configuration file (from 0.7.0_RELEASE)</li>
<li>Dynamically building ebin/sfmt.app (from 0.7.0_RELEASE)</li>
<li>PDIC_SEED now named differently for each period (bugfix, from 0.5.2_RELEASE)</li>
</ul><h2>
<a name="tested-platforms" class="anchor" href="#tested-platforms"><span class="octicon octicon-link"></span></a>Tested platforms</h2>

<ul>
<li>FreeBSD/amd64 10-STABLE with Erlang/OTP R16B03-1 and 17.0-rc1</li>
<li>OS X 10.9.1 Mavericks with Erlang/OTP R16B03-1 and 17.0-rc1</li>
</ul><h3>
<a name="past-tested-platforms" class="anchor" href="#past-tested-platforms"><span class="octicon octicon-link"></span></a>Past tested platforms</h3>

<ul>
<li>FreeBSD/amd64 9-STABLE with Erlang/OTP R16B02</li>
<li>FreeBSD/i386 8-STABLE with Erlang/OTP R15B03</li>
<li>Ubuntu Linux x86_64 12.10 with Erlang/OTP R16B</li>
</ul><h2>
<a name="building" class="anchor" href="#building"><span class="octicon octicon-link"></span></a>Building</h2>

<ul>
<li>
<p>Use GNU/BSD make and then</p>

<p>make compile</p>
</li>
</ul><p>The build script is Basho's rebar at <a href="https://github.com/basho/rebar">https://github.com/basho/rebar</a>,
which will be automatically fetched under the directory <code>support/</code>.</p>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<ul>
<li>
<p>For the HTML documentation files of the Erlang source </p>

<p>make doc</p>

<p>The documentation will be accessible at <code>doc/index.html</code>.</p>
</li>
<li>
<p>For the HTML documentation files of the C NIF source (Note: Doxygen required)</p>

<p>make c_doc</p>

<p>The documentation will be accessible at <code>c_doc/index.html</code>.</p>
</li>
</ul><h2>
<a name="testing" class="anchor" href="#testing"><span class="octicon octicon-link"></span></a>Testing</h2>

<ul>
<li>
<p>For unit testing with EUnit, do</p>

<p>make eunit</p>
</li>
<li>
<p>For testing the speed of 100 times of invoking 100000 <code>gen_rand32/1</code> function, do </p>

<p>make speed</p>

<p>(Previously this was 1000 times x 100000 invocations, but that was practically too slow.)</p>
</li>
</ul><h2>
<a name="api-compatible-with-the-random-module" class="anchor" href="#api-compatible-with-the-random-module"><span class="octicon octicon-link"></span></a>API compatible with the random module</h2>

<pre><code>seed0, seed/0, seed/3, uniform/0, uniform/1, uniform_s/1, uniform_s/3 
</code></pre>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>No more new feature; more load testing needed</li>
<li>More documentation</li>
<li>Code upgrading/reloading behavior check</li>
</ul><h2>
<a name="code-authors" class="anchor" href="#code-authors"><span class="octicon octicon-link"></span></a>Code authors:</h2>

<ul>
<li>Kenji Rikitake</li>
<li>Mutsuo Saito</li>
<li>Makoto Matsumoto</li>
<li>Dan Gudmundsson</li>
<li>Michael Truog</li>
</ul><h2>
<a name="thanks-to" class="anchor" href="#thanks-to"><span class="octicon octicon-link"></span></a>THANKS to:</h2>

<ul>
<li>Dave "dizzyd" Smith</li>
<li>Tuncer Ayaz</li>
<li>Tim Bates (random_mt.erl implementator of Mersenne Twister)</li>
<li>Dan Gudmundsson</li>
<li>Richard O'Keefe</li>
<li>Yurii Rashkovskii</li>
<li>Kostis Sagonas</li>
<li>Michael Gebetsroither</li>
<li>Shunichi Shinohara</li>
</ul><h2>
<a name="acknowledgments" class="anchor" href="#acknowledgments"><span class="octicon octicon-link"></span></a>ACKNOWLEDGMENTS</h2>

<p>During the compatibility test of this software, Kenji Rikitake
used the supercomputer service provided by Academic Center for
Computing and Media Studies (ACCMS), Kyoto University.</p>

<p>Erlang Solutions kindly gave Kenji Rikitake
an opportunity to give a presentation
about this software at Erlang Factory SF Bay 2011.</p>

<h2>
<a name="notes-on-refactoring" class="anchor" href="#notes-on-refactoring"><span class="octicon octicon-link"></span></a>Notes on refactoring</h2>

<ul>
<li>Speedup by NIF: ~40 times faster than the pure Erlang code
(when fully inline-optimized (see rebar.config))</li>
<li>For the pure-Erlang code: writing <code>++</code> (append) operators by ring buffer loops
(as a pair of lists consuming the head elements, and the corresponding accumulators)
made the code ~50% faster; the pure Erlang code available under <code>reference_texts/</code>
</li>
<li>
<code>gen_rand32/1</code>, <code>gen_rand32_max/2</code>, and <code>gen_rand_float/1</code> use Erlang lists 
(Dan Gudmudsson showed the list version is faster)</li>
<li>SSE2 code and options in sfmt-extstate were removed due to causing crash of Erlang BEAM
(and even if the SSE2 code was enabled the performance increase would be minimal)</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/jj1bdx">jj1bdx</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>